try {
    def currentState = subject.state
    if (!currentState) return
    
    // Сохраняем UUID текущего статуса в строку
    def statusUUID = currentState.UUID
    
    // Создайте атрибут preservedStatusUUID типа "Строка"
    def saved = subject.preservedStatusUUID
    
    if (saved && saved != statusUUID) {
        // Получаем сохраненный статус по UUID
        def savedState = utils.get(saved)
        if (savedState) {
            utils.edit(subject.UUID, [
                state: savedState,
                preservedStatusUUID: null
            ])
        }
    } else {
        // Сохраняем UUID
        utils.edit(subject.UUID, [
            preservedStatusUUID: statusUUID
        ])
    }
    
} catch (Exception e) {
    logger.error("Error: ${e.message}", e)
}